{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "30c0903a",
   "metadata": {},
   "outputs": [],
   "source": [
    "import streamlit as st\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "from matplotlib.patches import Polygon\n",
    "\n",
    "# --- 1. é¡µé¢é…ç½® ---\n",
    "st.set_page_config(page_title=\"ç¬¬33é¢˜åŠ¨æ€æ¼”ç¤º\", layout=\"wide\")\n",
    "\n",
    "# è§£å†³ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜ (Streamlit Cloud Linuxç¯å¢ƒé€šå¸¸æ²¡æœ‰é»‘ä½“ï¼Œè¿™é‡Œä½¿ç”¨é€šç”¨å­—ä½“å›é€€æ–¹æ¡ˆ)\n",
    "plt.rcParams['font.sans-serif'] = ['sans-serif'] \n",
    "plt.rcParams['axes.unicode_minus'] = False\n",
    "\n",
    "# --- 2. æ ¸å¿ƒæ•°å­¦é€»è¾‘ (ä¿æŒä¸å˜) ---\n",
    "def get_triangle_CDE(c, angle_deg):\n",
    "    theta = np.radians(angle_deg)\n",
    "    xc, yc = c, c\n",
    "    xd = xc + 2 * np.cos(theta)\n",
    "    yd = yc + 2 * np.sin(theta)\n",
    "    theta_de = theta - np.pi/2\n",
    "    xe = xd + 2 * np.cos(theta_de)\n",
    "    ye = yd + 2 * np.sin(theta_de)\n",
    "    return np.array([[xc, yc], [xd, yd], [xe, ye]])\n",
    "\n",
    "def apply_n_transform(points, n, progress):\n",
    "    trans_points = points.copy()\n",
    "    if progress <= 0.5:\n",
    "        # ç¿»æŠ˜é˜¶æ®µ\n",
    "        t = progress / 0.5\n",
    "        trans_points[:, 1] = points[:, 1] * (1 - t) + (2 * n - points[:, 1]) * t\n",
    "    else:\n",
    "        # å¹³ç§»é˜¶æ®µ\n",
    "        trans_points[:, 1] = 2 * n - points[:, 1]\n",
    "        t = (progress - 0.5) / 0.5\n",
    "        trans_points[:, 0] = points[:, 0] + t * n\n",
    "    return trans_points\n",
    "\n",
    "def check_validity(points, c):\n",
    "    # ç¨å¾®æ”¾å®½ä¸€ç‚¹ç²¾åº¦ï¼Œé¿å…æµ®ç‚¹æ•°è¯¯å·®\n",
    "    return points[1, 0] <= c + 1e-4 and points[2, 0] <= c + 1e-4\n",
    "\n",
    "def calc_c_range(angle_deg, n):\n",
    "    base_tri = get_triangle_CDE(0, angle_deg)\n",
    "    sum_D = base_tri[1, 0] + base_tri[1, 1]\n",
    "    sum_E = base_tri[2, 0] + base_tri[2, 1]\n",
    "    c1 = (n - sum_D) / 2\n",
    "    c2 = (n - sum_E) / 2\n",
    "    return min(c1, c2), max(c1, c2)\n",
    "\n",
    "# --- 3. ä¾§è¾¹æ æ§åˆ¶åŒº ---\n",
    "st.sidebar.header(\"ğŸ•¹ï¸ æ§åˆ¶é¢æ¿\")\n",
    "\n",
    "# 1. å˜æ¢åŠ¨ç”»\n",
    "prog = st.sidebar.slider(\"1. å˜æ¢è¿›åº¦ (nå‹å˜æ¢)\", 0.0, 1.0, 0.0, 0.01)\n",
    "\n",
    "# 2. å‡ ä½•å‚æ•°\n",
    "st.sidebar.markdown(\"---\")\n",
    "c = st.sidebar.slider(\"2. ç‚¹Cä½ç½® (å‚æ•° c)\", -5.0, 8.0, 1.0, 0.1)\n",
    "n = st.sidebar.slider(\"3. å‚æ•° n\", 1.0, 5.0, 3.0, 0.1)\n",
    "angle = st.sidebar.slider(\"4. æ—‹è½¬è§’åº¦\", 0.0, 360.0, 180.0, 5.0)\n",
    "\n",
    "# --- 4. ä¸»ç»˜å›¾åŒº ---\n",
    "st.title(\"ğŸ“ ç¬¬(3)é—®ï¼šnå‹å¯¹ç…§å˜æ¢ä¸cçš„å–å€¼èŒƒå›´\")\n",
    "st.markdown(\"æ‹–åŠ¨å·¦ä¾§æ»‘å—ï¼Œè§‚å¯Ÿä¸‰è§’å½¢çš„å˜åŒ–ã€‚\")\n",
    "\n",
    "# åˆ›å»ºå›¾å½¢\n",
    "fig, ax = plt.subplots(figsize=(8, 8))\n",
    "ax.set_aspect('equal')\n",
    "ax.set_xlim(-6, 12)\n",
    "ax.set_ylim(-6, 12)\n",
    "ax.grid(True, linestyle='--', alpha=0.4)\n",
    "\n",
    "# ç»˜åˆ¶è¾…åŠ©çº¿\n",
    "ax.plot([-10, 20], [-10, 20], 'k--', linewidth=1, label='y=x')\n",
    "ax.plot([-10, 20], [n, n], 'b-.', linewidth=1, label=f'y={n}')\n",
    "\n",
    "# è®¡ç®—æ•°æ®\n",
    "pts_orig = get_triangle_CDE(c, angle)\n",
    "is_valid = check_validity(pts_orig, c)\n",
    "pts_trans = apply_n_transform(pts_orig, n, prog)\n",
    "\n",
    "# ç»˜åˆ¶ä¸‰è§’å½¢\n",
    "if is_valid:\n",
    "    color_orig = 'purple'\n",
    "    color_trans = 'green'\n",
    "    alpha_trans = 0.6\n",
    "    status_msg = \"âœ… æ»¡è¶³é¢˜æ„ (xDâ‰¤c, xEâ‰¤c)\"\n",
    "else:\n",
    "    color_orig = 'gray'\n",
    "    color_trans = 'gray'\n",
    "    alpha_trans = 0.3\n",
    "    status_msg = \"âŒ ä¸åˆé¢˜æ„ (å­˜åœ¨ç‚¹æ¨ªåæ ‡ > c)\"\n",
    "\n",
    "# åŸä¸‰è§’å½¢\n",
    "poly_orig = Polygon(pts_orig, closed=True, fill=False, edgecolor=color_orig, linestyle='--', linewidth=1)\n",
    "ax.add_patch(poly_orig)\n",
    "\n",
    "# å˜æ¢åä¸‰è§’å½¢\n",
    "poly_trans = Polygon(pts_trans, closed=True, color=color_trans, alpha=alpha_trans)\n",
    "ax.add_patch(poly_trans)\n",
    "\n",
    "# æ ‡æ³¨é¡¶ç‚¹\n",
    "offset = 0.4\n",
    "labels = ['C', 'D', 'E']\n",
    "for i, p in enumerate(pts_orig):\n",
    "    ax.text(p[0], p[1]+offset, labels[i], color=color_orig, fontsize=10, ha='center')\n",
    "\n",
    "for i, p in enumerate(pts_trans):\n",
    "    ax.text(p[0], p[1]-offset, labels[i]+\"'\", color='darkgreen' if is_valid else 'gray', fontsize=10, ha='center')\n",
    "\n",
    "# è®¡ç®—å’Œç»˜åˆ¶ c çš„èŒƒå›´\n",
    "c_min, c_max = calc_c_range(angle, n)\n",
    "if is_valid:\n",
    "    ax.plot([c_min, c_max], [c_min, c_max], 'r-', linewidth=4, alpha=0.5, label='c å¯è¡ŒèŒƒå›´')\n",
    "\n",
    "# åˆ¤æ–­äº¤ç‚¹\n",
    "has_intersection = False\n",
    "if prog >= 0.99:\n",
    "    d_prime = pts_trans[1]\n",
    "    e_prime = pts_trans[2]\n",
    "    val_d = d_prime[1] - d_prime[0]\n",
    "    val_e = e_prime[1] - e_prime[0]\n",
    "    has_intersection = (val_d * val_e <= 0)\n",
    "\n",
    "# æ˜¾ç¤ºå›¾ä¾‹\n",
    "ax.legend(loc='upper left')\n",
    "\n",
    "# åœ¨ Streamlit ä¸­æ˜¾ç¤º Matplotlib å›¾å½¢\n",
    "st.pyplot(fig)\n",
    "\n",
    "# --- 5. æ–‡å­—ä¿¡æ¯åé¦ˆåŒº ---\n",
    "col1, col2 = st.columns(2)\n",
    "with col1:\n",
    "    st.info(f\"**å½“å‰çŠ¶æ€**: {status_msg}\")\n",
    "    \n",
    "    intersect_str = \"ç­‰å¾…å˜æ¢å®Œæˆ...\"\n",
    "    if prog >= 0.99:\n",
    "        intersect_str = \"ğŸ”´ ç›¸äº¤\" if has_intersection else \"ğŸ”µ ä¸ç›¸äº¤\"\n",
    "    st.write(f\"**D'E' ä¸ y=x å…³ç³»**: {intersect_str}\")\n",
    "\n",
    "with col2:\n",
    "    st.success(f\"**c çš„ç†è®ºèŒƒå›´**: [{c_min:.2f}, {c_max:.2f}]\")\n",
    "    \n",
    "    delta = 0.05\n",
    "    if c_min - delta <= c <= c_max + delta:\n",
    "         st.write(f\"**å½“å‰ c = {c:.2f}** (åœ¨èŒƒå›´å†… âœ…)\")\n",
    "    else:\n",
    "         st.write(f\"**å½“å‰ c = {c:.2f}** (åœ¨èŒƒå›´å¤–)\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
